# EmailService

The end purpose of EmailService is to provide an interface to send email.

It exposes a REST interface which accepts HTTP requests from web client like Postman or Advance Rest Client.
<br>
EmailService in turn internally use other email service providers like SendGrid, MailGun, SparkPost, JavaMail API to fulfill requested operation.
<br>
It uses the email service provider API in round robbin manner, to send the mail, where if one of the 
service provider fail to send the mail,it switch to the other email service provider to complete the task. 

## Modules
EmailService has following maven modules:

* ### connector
This module defines rest interfaces.

* ### serviceproviders
This module contains email service provider api's implementation which send the mail.

* ### util
This module defines the email routing logic.


## Getting Started:

### Prerequisites:

* Java 8.<br/>
* Maven 3.0.0.<br/>

### Maven command to create project's basic  modules 
> mvn archetype:generate -DgroupId=com.retailio.emailTask -DartifactId=emailTask-service -Dversion=1.0.0-SNAPSHOT -Dpackage=com.retailio.emailTask -DarchetypeGroupId=io.dropwizard.archetypes -DarchetypeArtifactId=java-simple -DinteractiveMode=true

### External Dependencies:
###### * javax.mail 1.4 for Java Mail API <br>
###### * net.sargue 1.3.2  for MailGun Mail API <br>
###### * com.sparkpost 0.17 for SparkPost Mail API
#### Note For Spark Post:
The SparkPost api implementation will always get error because I haven't define the sending domain like <br> 
 'gmail.com' etc in its api key, so it will always fail to send mail.
<br>
But its fine for the use case where we want to show that there will be other email service provider to send <br>
the mail  if one of the service provider fail to send the mail. 
<br>
###### * com.sendgrid 3.1.0 for SendGrid Mail API

#### Note For Send Grid:
Since sendgrid does not provide the maven dependency for its jar, you need to follow below steps.
<br>
* Download the Jar from 
    http://repo1.maven.org/maven2/com/sendgrid/sendgrid-java/3.2.0/sendgrid-java-3.2.0-jar.jar 
<br>
* Go to the folder where jar is downloaded and run the following command, it will register jar file in your <br>
.m2 repository folder
    > mvn install:install-file -Dfile=sendgrid-java-3.1.0-jar.jar -DgroupId=com.sendgrid -DartifactId=sendgrid -Dversion=3.1.0 -Dpackaging=jar 
 

## Installation:


### Build Project:
To build the project, run following command:
> mvn clean install

### Deployment:

* #### Build docker image:
Build new docker image of email service using below commands.<br/>
> Copy config.yml file into target folder <br/>
> cd main/target<br/>
> sudo docker build -t email-service . <br/>

* #### Run Docker Image:
To run the image, following command is used:<br/>
>  sudo docker run -d -p 8080:8080 -p 8081:8081  email-service

## How to test:
Import emailserviceprovider.postman_collection.json from the project folder in postman application.

## Documentation:

Application Notes for Email Service will be generated by running mvn install command.<br>
under directory /target/apidoc/com/retailio/emailservice/EmailServiceApplication.html

### Health Check
To see your applications health enter url `http://localhost:8081/healthcheck`

